# Ubuntu Tips

## Install Ubuntu
*Tools to install from scratch*
sudo apt-get install openssh-server  // so that it can be ssh server
sudo apt-get install nfs-common      // so that it can mount nfs file system

*Setup VNC server*
https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-14-04

Notice, the desktop is ```startxfce4 ```

## Install misc
win10 boot ubuntu
https://blog.csdn.net/u014422976/article/details/80393841


## Compile Kernel
link:http://mitchtech.net/compile-linux-kernel-on-ubuntu-12-04-lts-detailed/
### Install tools
sudo apt-get install git-core libncurses5 libncurses5-dev libelf-dev asciidoc binutils-dev linux-source libncurses5 libncurses5-dev fakeroot build-essential crash kexec-tools makedumpfile kernel-wedge kernel-package libssl-dev

### Download linux kernel and extract it
Website https://www.kernel.org/
I choose latest stable one :
wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.11.tar.xz
```
    $xz -d ***.tar.xz
    $tar -xvf  ***.tar
```
### Compile 
   1. cd <kernel-dir>/linux-4.11
   2. cp -vi /boot/config-`uname-r`  .config  // reuse curernt configure file
   3. make oldconfig ; //  parse .config, need to select feature, press enter if unsure
   4. make -j4 
## Useful APP
###
WIFI:

Broadcom BCM43142 802.11 bgn Wi-Fi M.2 Adapter
```
udo apt-get update 
sudo apt-get install --reinstall bcmwl-kernel-source 
```
### Chinese Input
### Flash plugin
    (http://www.linuxidc.com/Linux/2014-04/100490.htm)

## git vs perforce
###  Artichicture 
 - Git is distributed version control system while perforce is central version control systtem
 - See http://blog.csdn.net/garfish/article/details/46939383

### Command Vs Command

|Function             | perforce |  git       | comments|
|---------------------|----------|------------|----------|
| Check out worksapce | p4 sync  |  git clone <depot_link> |  Perforce needs P4CLIENT & P4PORT   |
| Add a file          | p4 add   | git add||
| update workspace |  p4 sync | git pull |  git would update both local repo and work copy|
| update a file or files | p4 sync file/files| no single command | |
|edit a file | p4 edit file/files | git add <modified_files>; git comment -a -m "message" | git add then commit |
|Move a file | p4 delete file; p4 add <other_dir>/file|git mv file \<other_dir\>||
|submit  to remove depot| p4 submit | git push -u origin master| |
| revert everyting| p4 revert ...| git reset --hard ||
|check opened files | p4 opened ... | git status||

## Kernel

**dump_strack()** : dump current callback stack

### Debug kernel
Two VM on same windows host:  http://www.server110.com/virtualbox/201402/6136.html <br>

English one: http://opensourceforu.efytimes.com/2011/03/kgdb-with-virtualbox-debug-live-kernel/ <br>


VirtualBox in Linux, target machine in vbox
http://blog.chinaunix.net/uid-27661220-id-3323015.html

Resize ubuntu disk
http://www.howtogeek.com/114503/how-to-resize-your-ubuntu-partitions/

## Bootup

 *   grub.cfg determines the menu entry 
 *   grub.cfg is generated by 'grub-mkconfig -o /boot/grub/grub.cfg'
 *   grub-mkconfig would find out the entris in /boot directory


 


 
## Regular commands
### rsync
used to sync files between servers, better than ftp <br>

general usage:  <br>
rsycn -vzrL  uname@server:\<src_path\> \<dst_path\>

-v : verbose <br>
-z : compressed transfer <br>
-r : recursive including all sub-directories <br>
-L : copy links as files <br>


*rsync without password
On local server:
   1. ssh-keygen # Use default setting
   2. ssh-copy-id -i ~/.ssh/id_rsa.pub \<remote host\>  # IP on remote host
   3. Now ssh and rsync requires no password

https://superuser.com/questions/555799/how-to-setup-rsync-without-password-with-ssh-on-unix-linux

### chmod

If a folder is copied from other location, you may met problems like "cannot chdir from <cur_dir> to <dst_dir> : Permission denied. Please use this commnd to fix: <br>
```tcsh
chmod -R 755 <folder_name>; #  -R is for recursive, 755 provides enough peviledge to access the folder
```
### zcat 
view .gz file without gunzip


### Generate List

http://vim.wikia.com/wiki/Increasing_or_decreasing_numbers

## Special device 
### /dev/null
In some caes, we don't want any output from a program,  so we can redirect it into ```/dev/null ``` like a black hole
``` csh
echo "hi, you cannot see me" >& /dev/null  # tcsh
echo "hi, you cannot see me" > /dev/null 2>&1 # bash
```

## redirection in Cshell
With this program compiled as ```out```
```c
#include <stdio.h>
int main()
{
    fprintf(stderr, "I am error\n");
    fprintf(stdout, "I am good\n");
}
~      
```

* Redirect stdout message into stdoutfile, error message will still be shown.<br>
```./out > stdoutfile ```

* Redirect stdout and stderr into stdoutfile, error message will not shown<br>
```./out >& stdoutfile ```

* dump stdout and stderr message separately <br>
```(out > stdoutfile)  >& stderrfile```

## Process management 
* ps
    * -l : long 
    * -F : extra long than -l
    * -C <cmd_name>: view a specific command 
    * -e : all process 
    
    ```
    ps -eLF | grep out
    
    0 S user_name   25745 13681  0  76   0 -   921 wait     364   7 18:01 pts/0    00:00:00 ./out
    1 S user_name   25746 25745  0  76   0 -   921 -        212   7 18:01 pts/0    00:00:00 ./out

    
    ```
    
## Tips

* How to increase virutal memory size after installation 
    * Sometime, we got error that says physical memory is not enough. So, we need to add swap file to allow more virtual memory
    
    https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04

* grep multiple  words
    * grep  'worda\\|wordb'
* find files with multiple key words
    * find . -name "*.h" -o -name "*.cpp"
* How switch between different versions of gcc

sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.3 10<br>
https://askubuntu.com/questions/26498/choose-gcc-and-g-version<br>

* How to suppress shell output

redirect the output to /dev/null
```
echo Hello, you cannot see me >& /dev/null
```

## Access control

Access control is to determine which process can access which resource.

A process is running on behalf of a user. 

In Linux system, each user is assigned with a UID.  When the user starts a process,  there is a concept of 'EUID' which means effective UID. By default EUID equals UID, but a process may want to promote or degrade priviledge, and it can call setuid or seteuid (affect real uid and euid) to change current uid. 

https://en.wikipedia.org/wiki/User_identifier <br>


## Unix Signal
Signal is a limited form of inter-process communication in Unix or Unix-like system. It is an a *asynchronous* notification btween process and threads 

https://en.wikipedia.org/wiki/Unix_signal

### SIGPIPE
The SIGPIPE signal is sent to a process when it attempts to write to a pipe without a process connected to the other end. 
See: 

```python
# Is it to avoid p1 to because zombie process?
p1 = Popen(["dmesg"], stdout=PIPE)
p2 = Popen(["grep", "hda"], stdin=p1.stdout, stdout=PIPE)
p1.stdout.close()  # Allow p1 to receive a SIGPIPE if p2 exits. 
output = p2.communicate()[0]
```

## Share folders 
### Between Linux
**Server side** 


*Install  nfs-kernel-server* 

sudo apt-get install nfs-kernel-server 

*Export your file by adding into /etc/exports, there are already example in that file*

*Restart NFS service*
 ```sudo service nfs-kernel-server start```
 
**client side**
sudo apt-get install nfs-common

``` mount <server_IP>:/home/lyq/exported_directory   /mnt ```


### Ubunut access windows shared folder
   1. Install cifs  so that mount recognize [rifs](https://technet.microsoft.com/en-us/library/cc939973.aspx) format
   ```sudo apt-get install cifs-utils```
   2. Mount remote shared folder from a windows machine 
    ```sudo mount -t cifs -o username=richli //10.237.169.126/shared /mnt/winfolder```


## Host name 
*check host name*<br>
```
hostname
```

*Modify host name*
   1. ```sudo vim /etc/hostname # replace old name with new name ```
   2. ``` sudo vim /etc/hosts # modify old name with new name```
   3. ``` sudo reboot```

reference : https://www.cyberciti.biz/faq/ubuntu-change-hostname-command/


## Linux file names 

|Dir                  | what     | 
|---------------------|----------|
| /etc/rc.local       | A place to put shell command that runs at bootup time.  .cshrc or .bashrc does is called during user login time, which does not meet the requirement. |
|/var/lock |   programer follows a convention to put a lock file in this directory to indicating "I" am taking this device exclusively|


A place to put shell command that runs at bootup time.  .cshrc or .bashrc does is called during user login time, which does not meet the requirement. 


## Open GUI for remote server 
**On Local server**

```
shtcoredev:~> echo $DISPLAY
localhost:12.0

xhost + # allow X server access from all clients
```

The format of DISPLAY environment variable is '\<hostname\>:\<display_number\>.\<screen_number\>' 

**On Remote Server**

Redirect DISPLAY var, and pointing to above display server 

```setenv DIPLAY <THE_HOST_INABOVE_CASE>:<DISPLAY_NUMBER>.<SCREEN_NUMBER>```
## du 



This command shows you the summarized size of hidden directories

```du -hs .[^.]*```

## Weired character when paste into gnome-terminal 
"""
For all having the issue as well and finding this topic through google:
something has enabled 'bracketed paste mode' on your terminal. gnome-terminal (and based on it terminator) does not handle it currently well, see for example:
http://www.midnight-commander.org/ticket/3207
To disable the bracketed paste mode:
printf "\e[?2004l"
(from http://cirw.in/blog/bracketed-paste)
Cures the terminal (gnome-terminal, terminator) immediately for me.
"""
https://bbs.archlinux.org/viewtopic.php?id=174595
